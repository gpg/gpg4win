#! /bin/sh
patch -p1 -l -f $* < $0
exit $?

From f03ec8346b25b5fbc24db1c3c4a4577b85e3d6d9 Mon Sep 17 00:00:00 2001
From: Markus Montkowski <markus.montkowski@gnupg.com>
Date: Thu, 16 Oct 2025 11:36:39 +0200
Subject: [PATCH 1/2] Add logging of Key flags for invalid keys

---
 src/keycache.cpp | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/src/keycache.cpp b/src/keycache.cpp
index 55e8efe..ee650d7 100644
--- a/src/keycache.cpp
+++ b/src/keycache.cpp
@@ -870,9 +870,10 @@ public:
         if (!key.canEncrypt() || key.isRevoked() ||
             key.isExpired() || key.isDisabled() || key.isInvalid())
           {
-            log_data ("%s:%s: Invalid key for %s. no internal encryption",
-                       SRCNAME, __func__, anonstr (recip.c_str ()));
+            log_data ("%s:%s: Invalid [%s%s%s%s%s] key for %s. no internal encryption",
+                       SRCNAME, __func__, key.canEncrypt()?"E":".", key.isRevoked()?"R":".",
+                        key.isExpired()?"X":".", key.isDisabled()?"D":".",
+                        key.isInvalid()?"I":".", anonstr (recip.c_str ()));
             TRETURN std::vector<GpgME::Key>();
           }

--
2.39.2
